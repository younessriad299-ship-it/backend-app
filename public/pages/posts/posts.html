<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Posts Table</title>
    <link rel="stylesheet" href="/css/style.css">
    <link rel="stylesheet" href="/css/create.css">
    <script src="/js/checkToken.js"></script>

</head>


<body>

    <header class="header">
        <div class="container">
            <div class="navigation">
                <div class="logo">ERAVIST</div>
                <a href="/" class="link">Home</a>
                <a href="/products" class="link">Products</a>
                <a href="/users" class="link">Users</a>
                <a href="/posts" class="link">Posts</a>
                <a href="/categories" class="link">Categories</a>

            </div>
            <div class="navigation">
                <a href="/checkout" class="link">Checkout</a>
                <a href="/blacklist" class="link">Blacklist <span>07</span></a>
                <a href="/faq" class="link">FAQ</a>
                <a href="/subscriber" class="link">Subscribers </a>
                <a href="/announces" class="link">Announces </a>
                <a href="/announces" class="link">Announces </a>
                <a href="/reviews" class="link">Reviews</a>
                <a href="/whatsapp" class="link">Whatsapp</a>
                <span class="link link-btn" onclick="logout()">Logout</span>

            </div>
        </div>
    </header>


    <div class="container">
        <div class="heading">
            <h3>Posts List</h3>
            <a href="/posts/create" class="button btn-add">New Post</a>
        </div>

        <!-- ✅ Table -->
        <table id="tableData" class="">
            <thead>
                <tr>
                    <th class="td-id">ID</th>
                    <th class="td-id">Image</th>
                    <th class="td-name">Title</th>
                    <th class="td-name">Subtitle</th>
                    <th class="td-id">Status</th>
                    <th>Date</th>
                    <th>Manage</th>

                </tr>
            </thead>
            <tbody></tbody>
        </table>



        <!-- ✅ Modal -->
        <div id="deleteModal" class="modal">
            <div class="modal-content">
                <div class="modal-header">
                    <h2 id="modalTitle">
                        Are you sure you want to delete this product?
                    </h2>
                    <span id="nameDeleteModal"></span>
                </div>
                <br>
                <br>
                
                <div class="modal-buttons">
                    <button class="button btn-action" onclick="deleteProductAPI()">Yes, Delete</button>
                    <button class="button btn-cancel" onclick="hideModal()">Cancel</button>
                </div>
            </div>
        </div>


    </div>


    <script>

        function fetchData() {
            console.log('fetchdata')

            let url = '/api/posts';


            fetch(url)
                .then(res => res.json())
                .then(data => {

                    const tbody = document.querySelector('#tableData tbody');
                    tbody.innerHTML = '';

                    data.forEach(post => {

                        const row = `
          <tr>
            <td class="td-id">${post.id}</td>
            <td class="td-id"><div class="img"><img src="${post.image}"</div> </td>
            <td class="td-name">${post.title} <span>${post.title_ar}</span> </td>
            <td class="td-name">${post.subtitle}</td>
            <td class="td-id"> ${post.status}</td>

            <td class='date'>${formatDate(post.created_at)}</td>

            <td>
                <span class='buttons'>
                    <a class='btn-edit' href="/posts/update/${post.id}">Edit</a>
                    <a class='btn-delete'  onclick='showModal(${post.id},  "${post.title}")'>Delete</a>
                </span>
            </td>
          </tr>
        `;

                        tbody.innerHTML += row;
                    });
                })
                .catch(err => console.error(err));
        }

 



        let productToID = 0
        let ProductName = ''
        // ✅ Show modal


        function showModal(id,name) {
                productToID = id;
                document.getElementById("nameDeleteModal").innerText = name
                document.getElementById("deleteModal").classList.add('active');
        }


        // ✅ Hide modal
        function hideModal() {
            productToID = 0;
            ProductName = '';
            document.getElementById("nameDeleteModal").innerText = ''

            document.getElementById("deleteModal").classList.remove('active');
        }


        // ✅ DELETE
        async function deleteProductAPI() {
            console.log(`/api/posts/${productToID}`)
            await fetch(`/api/posts/${productToID}`, { method: "DELETE" });
            fetchData();
            hideModal()
        }



        function formatDate(dateString) {
            const date = new Date(dateString);

            const dd = String(date.getDate()).padStart(2, '0');
            const mm = String(date.getMonth() + 1).padStart(2, '0');
            const yyyy = date.getFullYear();

            const hh = String(date.getHours()).padStart(2, '0');
            const min = String(date.getMinutes()).padStart(2, '0');
            const ss = String(date.getSeconds()).padStart(2, '0');

            return `<strong>${dd}-${mm}-${yyyy} </strong>  ${hh}:${min}:${ss}`;
        }
    </script>


</body>

</html>